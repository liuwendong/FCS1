{"remainingRequest":"/Users/apple/Desktop/华融催收APP开发/fcs/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/apple/Desktop/华融催收APP开发/fcs/src/pages/addRmas/component/AddAudio.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/apple/Desktop/华融催收APP开发/fcs/src/pages/addRmas/component/AddAudio.vue","mtime":1542272186715},{"path":"/Users/apple/Desktop/华融催收APP开发/fcs/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/apple/Desktop/华融催收APP开发/fcs/node_modules/cache-loader/dist/cjs.js","mtime":1539243342312},{"path":"/Users/apple/Desktop/华融催收APP开发/fcs/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  name: \"AddAudio\",\n  data() {\n    return {\n      audioList: [],\n      audioFile: [],\n      audioUrls: [],\n      upErr: false\n    };\n  },\n  props: {\n    beginUp: Boolean,\n    caseSubId: String\n  },\n  watch: {\n    beginUp(newVal) {\n      if (newVal === true) {\n        let self = this;\n        self.upErr = false;\n        if (this.audioFile.length > 0) {\n          var succNum = 0;\n          console.log(\"开始上传录音\");\n          for (let i = 0; i < this.audioFile.length; i++) {\n            if (self.upErr) break;\n            let file = this.audioFile[i];\n            let param = new FormData();\n            param.append(\"file\", file, file.name);\n            let config = { headers: { \"Content-Type\": \"multipart/form-data\" } };\n            let url =\n              \"api/ace-app/collectionAudio/audioAdd?caseSubId=\" +\n              self.caseSubId;\n            this.$axios\n              .post(url, param, config)\n              .then(response => {\n                console.log(response);\n                let mydata = response.data;\n                if (mydata.message == \"上传成功\") {\n                  succNum++;\n                  //保存返回的URL\n                  let url = mydata.data;\n                  self.audioUrls.push(url);\n                  if (succNum == this.audioFile.length) {\n                    //音频上传完\n                    self.$emit(\"audioUpFinish\", self.audioUrls);\n                  }\n                } else {\n                  self.upErr = true;\n                  self.$emit(\"audioUpErr\");\n                }\n              })\n              .catch(error => {\n                self.upErr = true;\n                console.log(error);\n                self.$emit(\"audioUpErr\");\n              });\n          }\n        } else {\n          self.$emit(\"audioUpFinish\", self.audioUrls);\n        }\n      }\n    }\n  },\n  methods: {\n    fileClick() {\n      let imgSel = document.getElementById(\"upload_file_audio\");\n      console.log(imgSel);\n      const event = new MouseEvent(\"click\");\n      imgSel.dispatchEvent(event);\n    },\n    fileChange(el) {\n      let self = this;\n      let file = el.target.files[0];\n      console.log(file);\n      var url = self.getFileURL(file);\n      self.audioList.push(url);\n      self.audioFile.push(file);\n    },\n    getFileURL(file) {\n      console.log(\"getFileURL\");\n      var getUrl = null;\n      if (window.createObjectURL != undefined) {\n        getUrl = window.createObjectURL(file);\n      } else if (window.URL != undefined) {\n        getUrl = window.URL.createObjectURL(file);\n      } else if (window.webkitURL != undefined) {\n        getUrl = window.webkitURL.createObjectURL(file);\n      }\n      return getUrl;\n    },\n    // //录音\n    // getAudio() {\n    //   var rec = plus.audio.getRecorder();\n    //   console.log(\"获取到的路由设备\" + rec);\n    //   rec.record(\n    //     {},\n    //     function(path) {\n    //       console.log(\"录音成功\");\n    //       plus.io.resolveLocalFileSystemURL(\n    //         path,\n    //         function(entry) {\n    //           console.log(entry.toLocalURL() + \" name=\" + entry.name);\n    //           self.audioList.push(entry.toLocalURL());\n    //         },\n    //         function(e) {\n    //           console.log(\"读取拍照文件错误\" + e.message);\n    //           plus.nativeUI.toast(\"读取拍照文件错误：\" + e.message);\n    //         }\n    //       );\n    //     },\n    //     function(error) {\n    //       console.log(\"录音失败\");\n    //     }\n    //   );\n    // },\n    // galleryAuido() {\n    //   let self = this;\n    //   plus.gallery.pick(\n    //     function(event) {\n    //       console.log(\"选择音频成功\");\n    //       for (var i in event.files) {\n    //         console.log(event.files[i]);\n    //         self.audioList.push(event.files[i]);\n    //       }\n    //     },\n    //     function(error) {\n    //       console.log(\"选择音频失败\" + error.message);\n    //     },\n    //     {\n    //       filter: \"video\",\n    //       multiple: true,\n    //       system: true\n    //     }\n    //   );\n    // },\n    // showActionSheet() {\n    //   let osName = plus.os.name;\n    //   if (osName === \"iOS\") {\n    //     this.showActionSheet_IOS();\n    //   } else {\n    //     this.showActionSheet_Android();\n    //   }\n    // },\n    // showActionSheet_IOS() {\n    //   let self = this;\n    //   let bts = [\n    //     {\n    //       title: \"从相册选择\"\n    //     }\n    //   ];\n    //   plus.nativeUI.actionSheet(\n    //     {\n    //       cancel: \"取消\",\n    //       buttons: bts\n    //     },\n    //     function(e) {\n    //       if (e.index == 1) {\n    //         self.galleryAuido();\n    //       }\n    //     }\n    //   );\n    // },\n    // showActionSheet_Android() {\n    //   let self = this;\n    //   let bts = [\n    //     {\n    //       title: \"录音\"\n    //     },\n    //     {\n    //       title: \"从相册选择\"\n    //     }\n    //   ];\n    //   plus.nativeUI.actionSheet(\n    //     {\n    //       cancel: \"取消\",\n    //       buttons: bts\n    //     },\n    //     function(e) {\n    //       if (e.index == 1) {\n    //         self.getAudio();\n    //       } else if (e.index == 2) {\n    //         self.galleryAuido();\n    //       }\n    //     }\n    //   );\n    // },\n    fileDel(index) {\n      let self = this;\n      self.audioList.splice(index, 1);\n    }\n  },\n  computed: {\n    showAudio() {\n      return this.audioList.length > 0;\n    }\n  }\n};\n",null]}